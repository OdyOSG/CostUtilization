% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/EunomiaTestHelpers.R
\name{transformCostToCdmV5dot5}
\alias{transformCostToCdmV5dot5}
\title{Transform Wide-Format COST to CDM v5.5 Long (Normalized) Structure}
\usage{
transformCostToCdmV5dot5(
  connectionDetails = Eunomia::getEunomiaConnectionDetails(),
  cdmDatabaseSchema = "main",
  sourceCostTable = "cost"
)
}
\arguments{
\item{connectionDetails}{DatabaseConnector connectionDetails. Defaults to Eunomia details.}

\item{cdmDatabaseSchema}{OMOP CDM schema/database. Default: "main".}

\item{sourceCostTable}{Name of the (wide) COST table to transform. Default: "cost".}
}
\value{
Returns the open DatabaseConnector \code{connection} (invisibly).
}
\description{
Backs up the wide-format \code{cost} table to \verb{\{schema\}.cost_v5_3_backup}, creates a new
v5.5-compliant \code{cost} table, and populates it by pivoting cost components into
normalized rows with \code{cost_concept_id}. Events are mapped to visits via a unified
eventâ†’visit/person/date table.
}
\details{
\itemize{
\item \strong{Backup}: \verb{ALTER TABLE \{schema\}.\{sourceCostTable\} RENAME TO cost_v5_3_backup}.
\item \strong{Visit mapping}: Builds a temporary \code{event_to_visit_map} from multiple domains,
including VISIT and VISIT_DETAIL. (Currently \code{visit_detail_id} is set to NULL in output.)
\item \strong{Normalization}: Emits one row per cost component (\code{total_cost}, \code{paid_by_payer}, ...),
with appropriate \code{cost_concept_id} and \code{cost_source_value}.
\item \strong{Dates}: \code{effective_date} defaults to event_date; \code{incurred_date} is event_date; \code{billed_date}/\code{paid_date} left NULL.
\item \strong{Concept defaults}: \code{cost_event_field_concept_id = 1147332} (constant), \code{currency_concept_id = 44818668 (USD)},
fallback \code{cost_type_concept_id = 31968} if absent.
}

Important:
\itemize{
\item The \strong{long table currently populates only \code{visit_occurrence_id}}; \code{visit_detail_id} is NULL.
If you intend to emit line-level costs, add logic to set \code{visit_detail_id} when
the cost event is a VISIT_DETAIL row (see "Suggested fixes").
\item Index creation uses vendor-neutral \verb{CREATE INDEX} syntax; adjust if your target
supports \code{CONCURRENTLY}/\code{ONLINE}.
}
}
\examples{
\dontrun{
transformCostToCdmV5dot5()
}
}
