% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/EunomiaTestHelpers.R
\name{injectVisitDetailsData}
\alias{injectVisitDetailsData}
\title{Populate VISIT_DETAIL from Event Domain Tables (line-item sub-visit records)}
\usage{
injectVisitDetailsData(connection, cdmDatabaseSchema = "main")
}
\arguments{
\item{connection}{A live DatabaseConnector connection.}

\item{cdmDatabaseSchema}{Schema containing OMOP CDM tables.}
}
\value{
Returns the \code{connection}. Called primarily for its side effects (table inserts).
}
\description{
Builds a visit-centric \strong{line-item} representation in \code{VISIT_DETAIL} by projecting
events from domain tables (PROCEDURE, MEASUREMENT, DEVICE, DRUG, OBSERVATION, CONDITION).
Each event becomes (typically) one \code{visit_detail_id}, preserving granular HEOR linkage.
}
\details{
Steps:
\enumerate{
\item (Re)Create \code{VISIT_DETAIL} table with CDM v5.5 columns.
\item Stage domain events with start/end, provider, and source fields.
\item Enrich with \code{VISIT_OCCURRENCE} and provider→care_site.
\item Generate stable \code{visit_detail_id}s and \code{preceding_visit_detail_id} within each
(person, visit) ordered by start time (then event_id).
\item Create helpful indexes for common query paths.
}

Assumptions:
\itemize{
\item \code{visit_detail_concept_id} is \strong{inherited from \code{VISIT_OCCURRENCE.visit_concept_id}} as a proxy.
Replace with domain-specific mappings if you have better semantics for sub-visit types.
\item \code{visit_detail_type_concept_id} prefers the domain’s \verb{*_type_concept_id}, falling back
to \code{VISIT_OCCURRENCE.visit_type_concept_id}.
\item \code{admitting/discharge} values are copied from the parent visit (can be customized).
}

Vendor notes:
\itemize{
\item Temporary table notation \code{tmp_event_detail_stage} is SQL Server style. The code uses
\code{renderTranslateExecuteSql()} \strong{only for the staging step} (so translation should
adapt the temp-table accordingly). Other statements use \code{executeSql()} and reference
the same temp name; ensure your dialect supports it after translation or convert
to a TEMP table name that works across targets.
}
}
\examples{
\dontrun{
injectVisitDetailsData(conn, cdmDatabaseSchema = "main")
}
}
